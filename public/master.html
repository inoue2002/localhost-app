<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>早押しクイズ | マスター</title>
    <style>
      :root { --bg:#0b1020; --fg:#e7ebf0; --muted:#9aa4b2; --accent:#3aa675; --danger:#d9534f; }
      * { box-sizing: border-box; }
      body { margin:0; background:var(--bg); color:var(--fg); font:16px/1.4 system-ui, -apple-system, sans-serif; }
      header { padding: 12px 16px; border-bottom: 1px solid #1b2440; display:flex; gap:12px; align-items:center; justify-content:space-between; }
      main { padding: 16px; display: grid; gap: 16px; }
      .row { display:flex; gap:8px; flex-wrap:wrap; }
      button { font:inherit; padding: 10px 14px; border-radius: 8px; border:1px solid #2f405f; cursor: pointer; }
      .open { background: var(--accent); color:#04110b; font-weight:700; }
      .reset { background: transparent; color: var(--fg); }
      .danger { border-color:#733338; color:#ffd7d7; background:#3a0f12; }
      .badge { padding:4px 8px; border-radius:999px; background:#1a2344; color:var(--muted); }
      .list { display:grid; gap:8px; }
      .item { background:#0e1630; border:1px solid #1b2440; border-radius:8px; padding:10px 12px; }
      .hint { color: var(--muted); }
      a { color: var(--muted); }
    </style>
  </head>
  <body>
    <header>
      <div>早押しクイズ | マスター <span id="state" class="badge">closed</span></div>
      <a href="/">トップ</a>
    </header>
    <main>
      <div class="row">
        <button id="open" class="open">受付開始（Open）</button>
        <button id="reset" class="reset danger">リセット（結果クリア）</button>
      </div>
      <section>
        <h3>最初に押した人</h3>
        <div id="first" class="item hint">未決定</div>
      </section>
      <section>
        <h3>押した順</h3>
        <div id="order" class="list"></div>
      </section>
      <p class="hint">参加者は <code>/user.html</code> へアクセスし、名前を入れて「早押し」してください。</p>
    </main>
    <script>
      const stateEl = document.getElementById('state');
      const firstEl = document.getElementById('first');
      const orderEl = document.getElementById('order');
      const btnOpen = document.getElementById('open');
      const btnReset = document.getElementById('reset');

      function renderState(s) {
        stateEl.textContent = s.isOpen ? 'open' : 'closed';
        firstEl.textContent = s.first ? `${s.first.name} (${new Date(s.first.ts).toLocaleTimeString()})` : '未決定';
        orderEl.innerHTML = '';
        (s.order || []).forEach((it, idx) => {
          const div = document.createElement('div');
          div.className = 'item';
          div.textContent = `${idx+1}. ${it.name} (${new Date(it.ts).toLocaleTimeString()})`;
          orderEl.appendChild(div);
        });
      }

      const es = new EventSource('/events');
      es.addEventListener('quiz_state', ev => {
        try { renderState(JSON.parse(ev.data)); } catch {}
      });
      es.addEventListener('buzz', ev => {
        try { const s = JSON.parse(ev.data); /* will be followed by state */ } catch {}
      });

      btnOpen.onclick = async () => {
        await fetch('/quiz/open', { method:'POST' });
      };
      btnReset.onclick = async () => {
        await fetch('/quiz/reset', { method:'POST' });
      };
    </script>
  </body>
  </html>

